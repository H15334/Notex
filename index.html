<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notex v1 - Notes App (Offline)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      // Tailwind configuration - Added font families
      tailwind.config = {
        darkMode: 'class',
        theme: {
          extend: {
            fontFamily: {
              sans: ['Inter', 'sans-serif'], // Default sans-serif
              serif: ['Times New Roman', 'serif'], // Added serif
              mono: ['Courier New', 'monospace'], // Added monospace
            },
            transitionProperty: {
              'width': 'width',
              'height': 'height',
              'spacing': 'margin, padding',
            },
            keyframes: {
              'fade-in': { '0%': { opacity: '0' }, '100%': { opacity: '1' } },
              'slide-up': { '0%': { transform: 'translateY(20px)', opacity: '0' }, '100%': { transform: 'translateY(0)', opacity: '1' } },
              'pulse': { '0%, 100%': { opacity: '1' }, '50%': { opacity: '0.5' } }
            },
            animation: {
              'fade-in': 'fade-in 0.3s ease-out',
              'slide-up': 'slide-up 0.3s ease-out',
              'pulse': 'pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite',
            },
          },
        },
      }
    </script>
    <style>
      /* Custom Scrollbars */
      ::-webkit-scrollbar { width: 10px; height: 10px; }
      ::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 10px; }
      ::-webkit-scrollbar-thumb { background: #c1c1c1; border-radius: 10px; border: 2px solid #f1f1f1; }
      ::-webkit-scrollbar-thumb:hover { background: #a8a8a8; }
      .dark ::-webkit-scrollbar-track { background: #2d3748; }
      .dark ::-webkit-scrollbar-thumb { background: #4a5568; border-color: #2d3748; }
      .dark ::-webkit-scrollbar-thumb:hover { background: #5f6b82; }

      /* Editor styling - Base styles */
      [contenteditable="true"] {
        border: 1px solid #d1d5db; /* Light border */
        border-radius: 0.5rem;
        padding: 0.75rem;
        min-height: 150px;
        outline: none;
        transition: all 0.2s ease;
        overflow-wrap: break-word;
        word-wrap: break-word;
        word-break: break-word;
        white-space: pre-wrap;
        overflow-y: auto;
        background-color: white; /* Explicit background */
      }
      .dark [contenteditable="true"] {
        border-color: #4b5563; /* Dark border */
        background-color: #374151; /* Dark background */
        color: #d1d5db;
      }
      [contenteditable="true"]:focus {
        border-color: #d1d5db;
        --tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);
        --tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color);
        box-shadow: var(--tw-ring-offset-shadow), var(--tw-ring-shadow), var(--tw-shadow, 0 0 #0000);
        --tw-ring-color: #3b82f6;
      }
      .dark [contenteditable="true"]:focus {
        border-color: #4b5563;
        --tw-ring-color: #60a5fa;
      }

      /* Apply font settings to the editor area */
      #noteEditor.font-sans, #noteEditor.font-sans * { font-family: 'Inter', sans-serif; }
      #noteEditor.font-serif, #noteEditor.font-serif * { font-family: 'Times New Roman', serif; }
      #noteEditor.font-mono, #noteEditor.font-mono * { font-family: 'Courier New', monospace; }

      /* Format buttons */
      .format-button { display: inline-flex; align-items: center; justify-content: center; padding: 0.3rem 0.5rem; border: 1px solid #d1d5db; border-radius: 0.375rem; background-color: #f3f4f6; color: #374151; transition: all 0.2s ease; font-weight: bold; min-width: 30px; min-height: 30px; text-align: center; }
      .format-button svg { width: 1em; height: 1em; }
      .format-button:hover { background-color: #e5e7eb; transform: translateY(-1px); }
      .format-button:active { transform: translateY(1px); }
      .format-button.active { background-color: #dbeafe; border-color: #93c5fd; color: #1e40af; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1); }
      .dark .format-button { background-color: #4b5563; color: #d1d5db; border-color: #6b7280; }
      .dark .format-button:hover { background-color: #374151; }
      .dark .format-button.active { background-color: #374151; border-color: #6b7280; color: #eff6ff; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2); }

      /* Checklist specific styles */
      #noteContent ul.checklist { list-style: none; padding-left: 0.5rem; margin-top: 0.5rem; margin-bottom: 0.5rem; }
      #noteContent ul.checklist li { display: flex; align-items: flex-start; margin-bottom: 0.25rem; padding-left: 0; }
      #noteContent ul.checklist li input[type="checkbox"] { margin-right: 0.5rem; margin-top: 0.25em; flex-shrink: 0; cursor: pointer; width: 1.1em; height: 1.1em; }
      #noteContent ul.checklist li span { flex-grow: 1; outline: none; transition: all 0.2s ease; }
      #noteContent ul.checklist li input[type="checkbox"]:checked + span { text-decoration: line-through; opacity: 0.6; color: #6b7280; }
      .dark #noteContent ul.checklist li input[type="checkbox"]:checked + span { color: #9ca3af; }
      #noteContent ul.checklist li span[contenteditable="true"] { display: inline-block; min-width: 10px; }

      /* Tags */
      .tag { display: inline-block; background-color: #e0e7ff; color: #3730a3; padding: 0.25rem 0.5rem; border-radius: 9999px; font-size: 0.75rem; font-weight: 500; margin-right: 0.25rem; margin-bottom: 0.25rem; transition: all 0.2s ease; border: 1px solid #c7d2fe; }
      .tag:hover { transform: scale(1.05); background-color: #c7d2fe; }
      .dark .tag { background-color: #3730a3; color: #e0e7ff; border-color: #4338ca; }
      .dark .tag:hover { background-color: #4338ca; }

      /* Modal */
      .modal { display: none; position: fixed; z-index: 50; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.5); align-items: center; justify-content: center; animation: fade-in 0.3s ease-out; }
      .modal.flex { display: flex; }
      .modal-content { margin: auto; padding: 1.5rem; border-radius: 0.5rem; width: 90%; max-width: 500px; animation: slide-up 0.3s ease-out; border: 1px solid #e5e7eb; }
      .dark .modal-content { border-color: #374151; }

      /* Toggle switch */
      .toggle-switch { position: relative; display: inline-block; width: 50px; height: 26px; }
      .toggle-switch input { display: none; }
      .toggle-slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 26px; border: 1px solid #bbb; }
      .toggle-slider:before { position: absolute; content: ""; height: 20px; width: 20px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; box-shadow: 0 1px 2px rgba(0,0,0,0.2); }
      input:checked + .toggle-slider { background-color: #2563eb; border-color: #1d4ed8; }
      input:checked + .toggle-slider:before { transform: translateX(24px); }
      .dark .toggle-slider { background-color: #4b5563; border-color: #374151; }
      .dark input:checked + .toggle-slider { background-color: #3b82f6; border-color: #2563eb; }

      /* Clear search button */
      #clearSearchBtn { position: absolute; right: 0.5rem; top: 50%; transform: translateY(-50%); background: none; border: none; padding: 0.25rem; cursor: pointer; color: #9ca3af; display: none; transition: all 0.2s ease; }
      #clearSearchBtn:hover { color: #6b7280; transform: translateY(-50%) scale(1.1); }
      .dark #clearSearchBtn { color: #6b7280; }
      .dark #clearSearchBtn:hover { color: #9ca3af; }
      #clearSearchBtn svg { width: 1.1em; height: 1.1em; }

      /* Selection indicators */
      .note-item.selected { background-color: #dbeafe !important; border-color: #93c5fd !important; box-shadow: 0 2px 8px rgba(59, 130, 246, 0.2); transform: translateX(4px); }
      .dark .note-item.selected { background-color: #1e3a8a !important; border-color: #3b82f6 !important; box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3); }
      .note-item { transition: all 0.3s ease; cursor: grab; }

      /* Notes list scroll container */
      #notesList { scrollbar-width: thin; scrollbar-color: #c1c1c1 #f1f1f1; }
      .dark #notesList { scrollbar-color: #4a5568 #2d3748; }

      /* --- Mobile View & Fullscreen Control --- */
      body:not(.editor-fullscreen) #sidebar { display: flex; width: 100%; }
      body:not(.editor-fullscreen) #editorArea { display: none; }
      body.editor-fullscreen #sidebar { display: none; }
      body.editor-fullscreen #editorArea { display: flex; position: fixed; top: 0; left: 0; right: 0; bottom: 0; z-index: 1000; padding: 1rem; background: white; width: 100%; height: 100%; max-width: none; border-radius: 0; animation: fade-in 0.3s ease-out; }
      .dark body.editor-fullscreen #editorArea { background: #1f2937; }

      /* Desktop state */
      @media (min-width: 768px) {
        body:not(.editor-fullscreen) #sidebar { display: flex; width: 33.333333%; }
        body:not(.editor-fullscreen) #editorArea { display: flex; position: relative; width: 66.666667%; height: auto; max-width: none; padding: 1.5rem; z-index: auto; border-radius: 0; animation: none; border-left: 1px solid #e5e7eb; }
        .dark body:not(.editor-fullscreen) #editorArea { background: #1f2937; border-left-color: #374151; }
        body.editor-fullscreen #sidebar { display: none; }
        body.editor-fullscreen #editorArea { display: flex; position: fixed; top: 0; left: 0; right: 0; bottom: 0; z-index: 1000; padding: 1rem; background: white; width: 100%; height: 100%; max-width: none; border-radius: 0; animation: fade-in 0.3s ease-out; border-left: none; }
         .dark body.editor-fullscreen #editorArea { background: #1f2937; border-left: none; }
      }

      /* --- Styles for Editor Content within Fullscreen --- */
      body.editor-fullscreen #noteEditor { height: 100%; display: flex; flex-direction: column; width: 100%; margin: 0 auto; padding: 0; }
      /* Font size applied via JS class */
      body.editor-fullscreen #noteContent { flex-grow: 1; min-height: auto; /* font-size: 1.1rem; */ line-height: 1.6; }
      body.editor-fullscreen #noteTitle { /* font-size: 1.8rem; */ padding: 0.5rem 0.75rem; margin-bottom: 1rem; text-align: center; }
      body.editor-fullscreen #editorHeader { margin-bottom: 1rem; padding: 0; }
      body:not(.editor-fullscreen) #backBtn { display: none !important; }
      body.editor-fullscreen #backBtn { display: flex !important; }

      /* --- Styles for Editor Content in Regular View --- */
       /* Font size applied via JS class */
       body:not(.editor-fullscreen) #noteContent { /* font-size: inherit; */ line-height: inherit; }
       .dark body:not(.editor-fullscreen) #noteContent { }
       body:not(.editor-fullscreen) #noteTitle { /* font-size: 1.5rem; */ padding: 0.75rem; margin-bottom: 1rem; text-align: left; }
       .dark body:not(.editor-fullscreen) #noteTitle { }

       /* --- Drag and Drop Styling --- */
       .note-item.dragging { opacity: 0.5; background-color: #e0f2fe; border: 1px dashed #0ea5e9; cursor: grabbing; }
       .dark .note-item.dragging { background-color: #0c4a6e; border-color: #38bdf8; }
       .drag-over { border-top: 2px solid #3b82f6 !important; transition: border-top 0.1s ease-in-out; }
       .note-item.dragging.drag-over { border-top: none !important; }

       /* Enhanced New Note Button Style */
       #newNoteBtn { background-image: linear-gradient(to right, #3b82f6, #60a5fa); box-shadow: 0 4px 6px -1px rgba(59, 130, 246, 0.3), 0 2px 4px -1px rgba(59, 130, 246, 0.2); font-weight: 600; letter-spacing: 0.025em; }
       #newNoteBtn:hover { background-image: linear-gradient(to right, #2563eb, #3b82f6); box-shadow: 0 6px 8px -1px rgba(37, 99, 235, 0.4), 0 4px 6px -1px rgba(37, 99, 235, 0.3); transform: translateY(-1px); }
       .dark #newNoteBtn { background-image: linear-gradient(to right, #1d4ed8, #2563eb); box-shadow: 0 4px 6px -1px rgba(29, 78, 216, 0.4), 0 2px 4px -1px rgba(29, 78, 216, 0.3); }
       .dark #newNoteBtn:hover { background-image: linear-gradient(to right, #1e3a8a, #1d4ed8); box-shadow: 0 6px 8px -1px rgba(30, 58, 138, 0.5), 0 4px 6px -1px rgba(30, 58, 138, 0.4); }

       /* Style for icon buttons */
       .icon-button { display: inline-flex; align-items: center; justify-content: center; padding: 0.5rem; border-radius: 9999px; transition: all 0.2s ease; border: 1px solid transparent; }
       .icon-button svg { width: 1.25rem; height: 1.25rem; }
       .icon-button:hover { transform: scale(1.1); }

       /* Specific icon button styles */
       #settingsBtn:hover { background-color: rgba(255, 255, 255, 0.1); border-color: rgba(255, 255, 255, 0.3); }
       #clearSearchBtn svg { width: 1rem; height: 1rem; }
       #backBtn { gap: 0.5rem; }
       #backBtn svg { width: 1.25rem; height: 1.25rem; }
       #deleteNoteBtn { gap: 0.5rem; }
       #deleteNoteBtn svg { width: 1.25rem; height: 1.25rem; }
       #closeSettingsBtn svg { width: 1.25rem; height: 1.25rem; }

       /* Settings Dropdown Style */
       .settings-select {
           width: 100%;
           padding: 0.5rem 0.75rem;
           border: 1px solid #d1d5db;
           border-radius: 0.375rem;
           background-color: white;
           color: #374151;
           appearance: none; /* Remove default arrow */
           background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
           background-position: right 0.5rem center;
           background-repeat: no-repeat;
           background-size: 1.5em 1.5em;
           transition: border-color 0.2s ease;
       }
       .settings-select:focus {
           outline: none;
           border-color: #3b82f6;
           box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.3);
       }
       .dark .settings-select {
           background-color: #4b5563;
           border-color: #6b7280;
           color: #d1d5db;
           background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%239ca3af' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
       }
        .dark .settings-select:focus {
            border-color: #60a5fa;
            box-shadow: 0 0 0 2px rgba(96, 165, 250, 0.3);
        }


    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="bg-gray-100 dark:bg-gray-900 font-sans flex flex-col h-screen transition-colors duration-300">

    <header class="bg-blue-600 dark:bg-blue-800 text-white p-4 shadow-md flex justify-between items-center transition-all duration-300 z-10">
        <h1 class="text-2xl font-bold animate-slide-up">My Notes</h1>
        <button id="settingsBtn" title="Settings" class="icon-button text-white hover:text-blue-200 hover:bg-blue-700 dark:hover:bg-blue-900 hover:rotate-45 hover:border-blue-300">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"> <path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" /> <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /> </svg>
        </button>
    </header>

    <div class="flex flex-1 overflow-hidden transition-all duration-300">
        <aside id="sidebar" class="bg-white dark:bg-gray-800 border-r border-gray-200 dark:border-gray-700 flex flex-col transition-all duration-300">
            <div class="p-4 border-b border-gray-200 dark:border-gray-700 space-y-3 animate-fade-in">
                <div class="relative">
                    <input type="search" id="searchInput" placeholder="Search notes..." class="w-full p-2 pl-8 pr-10 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 placeholder-gray-400 dark:placeholder-gray-500 transition-all duration-300">
                    <span class="absolute left-2.5 top-1/2 transform -translate-y-1/2 text-gray-400 dark:text-gray-500 pointer-events-none transition-all duration-300"> <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"> <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" /> </svg> </span>
                    <button id="clearSearchBtn" title="Clear search" class="transition-all duration-300"> <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"> <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /> </svg> </button>
                </div>
                <button id="newNoteBtn" class="w-full text-white py-2.5 px-4 rounded-lg flex items-center justify-center transition-all duration-300 active:scale-95 border border-transparent focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-800">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor"> <path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h6a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h6a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd" /> </svg>
                     List New Note
                </button>
            </div>
            <div id="notesList" class="flex-1 overflow-y-auto p-2 space-y-1 animate-fade-in"> </div>
        </aside>

        <main id="editorArea" class="flex-1 bg-gray-50 dark:bg-gray-900 p-6 flex flex-col relative transition-all duration-300">
            <div id="noteEditor" class="flex flex-col h-full hidden animate-fade-in">
                <div id="editorHeader" class="flex justify-between items-center mb-4 transition-all duration-300">
                    <button id="backBtn" title="Back to Notes" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 transition-all duration-300 hover:scale-105 active:scale-95 flex items-center border border-transparent hover:border-gray-300 dark:hover:border-gray-600"> <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"> <path stroke-linecap="round" stroke-linejoin="round" d="M10 19l-7-7m0 0l7-7m-7 7h18" /> </svg> <span class="hidden sm:inline">Back</span> </button>
                    <button id="deleteNoteBtn" title="Delete Note" class="text-red-500 hover:text-red-700 dark:text-red-400 dark:hover:text-red-500 p-2 rounded-lg hover:bg-red-100 dark:hover:bg-gray-700 transition-all duration-300 hover:scale-105 active:scale-95 flex items-center border border-transparent hover:border-red-300 dark:hover:border-red-500"> <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"> <path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /> </svg> <span class="hidden sm:inline">Delete</span> </button>
                </div>

                <input type="text" id="noteTitle" placeholder="Note Title" class="text-2xl font-semibold p-3 mb-4 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 placeholder-gray-400 dark:placeholder-gray-500 transition-all duration-300">

                <div class="flex space-x-1 mb-2 p-2 bg-gray-100 dark:bg-gray-700 rounded-md border border-gray-200 dark:border-gray-600 transition-all duration-300">
                    <button class="format-button" data-command="bold" title="Bold">B</button>
                    <button class="format-button" data-command="italic" title="Italic">I</button>
                    <button class="format-button" data-command="underline" title="Underline">U</button>
                    <button class="format-button" id="checklistBtn" title="Checklist"> <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"> <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" /> </svg> </button>
                </div>

                <div id="noteContent" contenteditable="true" class="flex-1 text-gray-900 dark:text-gray-100 transition-all duration-300 overflow-auto"></div>

                <div class="mt-4 transition-all duration-300 border border-gray-200 dark:border-gray-600 rounded-lg p-3 bg-white dark:bg-gray-700">
                     <label for="noteTags" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1 flex items-center"> <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1 text-gray-500 dark:text-gray-400" viewBox="0 0 20 20" fill="currentColor"> <path fill-rule="evenodd" d="M17.707 9.293a1 1 0 010 1.414l-7 7a1 1 0 01-1.414 0l-7-7A.997.997 0 012 10V5a3 3 0 013-3h5a.997.997 0 01.707.293l7 7zM5 6a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd" /> </svg> Tags (comma-separated) </label>
                    <input type="text" id="noteTags" placeholder="e.g., work, ideas, important" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 placeholder-gray-400 dark:placeholder-gray-500 transition-all duration-300">
                    <div id="tagsPreview" class="mt-2 flex flex-wrap transition-all duration-300"> </div>
                </div>
            </div>
            <div id="noNoteSelected" class="flex-1 flex items-center justify-center text-gray-500 dark:text-gray-400 text-center hidden"> <p>Select a note from the list or create a new one.</p> </div>
        </main>
    </div>

    <div id="settingsModal" class="modal bg-black/50 dark:bg-black/70">
        <div class="modal-content bg-white dark:bg-gray-800 shadow-xl text-gray-900 dark:text-gray-100 border border-gray-300 dark:border-gray-600">
            <div class="flex justify-between items-center border-b border-gray-200 dark:border-gray-700 pb-3 mb-4">
                <h2 class="text-xl font-semibold">Settings</h2>
                <button id="closeSettingsBtn" class="icon-button text-gray-500 hover:text-gray-800 dark:text-gray-400 dark:hover:text-white hover:rotate-90 p-1 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 border border-transparent hover:border-gray-300 dark:hover:border-gray-600"> <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"> <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /> </svg> </button>
            </div>
            <div class="space-y-5"> <div class="flex justify-between items-center">
                    <label for="darkModeToggle" class="font-medium flex items-center gap-2">
                        <span id="themeIconContainer" class="inline-flex items-center justify-center w-5 h-5"> </span> Dark Mode
                    </label>
                    <label class="toggle-switch"> <input type="checkbox" id="darkModeToggle"> <span class="toggle-slider"></span> </label>
                </div>

                <div class="flex justify-between items-center">
                     <label for="fontSizeSelect" class="font-medium flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-500 dark:text-gray-400" viewBox="0 0 20 20" fill="currentColor"> <path fill-rule="evenodd" d="M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.707.707L4.586 13H2a1 1 0 01-1-1V8a1 1 0 011-1h2.586l3.707-3.707a1 1 0 011.09-.217zM12.293 7.293a1 1 0 011.414 0L15 8.586l1.293-1.293a1 1 0 111.414 1.414L16.414 10l1.293 1.293a1 1 0 01-1.414 1.414L15 11.414l-1.293 1.293a1 1 0 01-1.414-1.414L13.586 10l-1.293-1.293a1 1 0 010-1.414z" clip-rule="evenodd" /> </svg>
                        Font Size
                    </label>
                    <select id="fontSizeSelect" class="settings-select w-1/2"> <option value="text-sm">Small</option>
                        <option value="text-base">Medium</option>
                        <option value="text-lg">Large</option>
                    </select>
                </div>

                 <div class="flex justify-between items-center">
                    <label for="fontFamilySelect" class="font-medium flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-500 dark:text-gray-400" viewBox="0 0 20 20" fill="currentColor"> <path d="M10 12a2 2 0 100-4 2 2 0 000 4z" /> <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.022 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd" /> </svg>
                        Font Family
                    </label>
                    <select id="fontFamilySelect" class="settings-select w-1/2"> <option value="font-sans">Sans-serif</option>
                        <option value="font-serif">Serif</option>
                        <option value="font-mono">Monospace</option>
                    </select>
                </div>

                <hr class="border-gray-200 dark:border-gray-600 my-4">
                <div class="text-center text-sm text-gray-500 dark:text-gray-400 space-y-1">
                    <p>Notex version 1 (Offline Enabled)</p>
                    <p>Created by Himanshu pal</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- DOM Elements ---
        const notesListEl = document.getElementById('notesList');
        const searchInput = document.getElementById('searchInput');
        const clearSearchBtn = document.getElementById('clearSearchBtn');
        const newNoteBtn = document.getElementById('newNoteBtn');
        const noteEditorEl = document.getElementById('noteEditor');
        const noteTitleInput = document.getElementById('noteTitle');
        const noteContentInput = document.getElementById('noteContent');
        const noteTagsInput = document.getElementById('noteTags');
        const tagsPreviewEl = document.getElementById('tagsPreview');
        const deleteNoteBtn = document.getElementById('deleteNoteBtn');
        const editorAreaEl = document.getElementById('editorArea');
        const settingsBtn = document.getElementById('settingsBtn');
        const settingsModal = document.getElementById('settingsModal');
        const closeSettingsBtn = document.getElementById('closeSettingsBtn');
        const darkModeToggle = document.getElementById('darkModeToggle');
        const themeIconContainer = document.getElementById('themeIconContainer');
        const fontSizeSelect = document.getElementById('fontSizeSelect'); // Font size dropdown
        const fontFamilySelect = document.getElementById('fontFamilySelect'); // Font family dropdown
        const formatButtons = document.querySelectorAll('.format-button');
        const checklistBtn = document.getElementById('checklistBtn');
        const backBtn = document.getElementById('backBtn');
        const sidebarEl = document.getElementById('sidebar');
        const bodyEl = document.body;
        const noNoteSelectedEl = document.getElementById('noNoteSelected');

        // --- SVG Icons ---
        const moonIconSVG = `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" /></svg>`;
        const sunIconSVG = `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" /></svg>`;

        // --- State Variables ---
        let notes = [];
        let selectedNoteId = null;
        let isFullscreen = false;
        // Default settings including new customization options
        let settings = {
            darkMode: false,
            fontSize: 'text-base', // Default font size (Tailwind class)
            fontFamily: 'font-sans' // Default font family (Tailwind class)
        };
        let debounceTimer;
        let draggedItemId = null;

        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            loadSettings();
            applySettings(); // Apply all loaded settings
            loadNotes();
            renderNotesList();
            setupEventListeners();
            checkInitialState();
            registerServiceWorker();
        });

        // --- Service Worker Registration ---
        function registerServiceWorker() {
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('sw.js')
                    .then(registration => console.log('Service Worker registered:', registration.scope))
                    .catch(error => console.error('Service Worker registration failed:', error));
            } else { console.log('Service Worker not supported.'); }
        }

        // --- Settings Management ---
        function loadSettings() {
            const savedSettings = localStorage.getItem('notesAppSettings');
            if (savedSettings) {
                // Merge saved settings with defaults to ensure new settings are present
                settings = { ...settings, ...JSON.parse(savedSettings) };
            }
            // Update UI elements in the modal to reflect loaded settings
            darkModeToggle.checked = settings.darkMode;
            fontSizeSelect.value = settings.fontSize;
            fontFamilySelect.value = settings.fontFamily;
        }
        function saveSettings() {
            localStorage.setItem('notesAppSettings', JSON.stringify(settings));
        }
        function applySettings() {
            // 1. Dark Mode
            if (settings.darkMode) {
                document.documentElement.classList.add('dark');
                themeIconContainer.innerHTML = sunIconSVG;
            } else {
                document.documentElement.classList.remove('dark');
                themeIconContainer.innerHTML = moonIconSVG;
            }

            // 2. Font Size & Family
            // Remove existing classes before applying new ones
            noteEditorEl.classList.remove('text-sm', 'text-base', 'text-lg', 'font-sans', 'font-serif', 'font-mono');
            // Apply current settings classes
            if (settings.fontSize) {
                noteEditorEl.classList.add(settings.fontSize);
            }
            if (settings.fontFamily) {
                noteEditorEl.classList.add(settings.fontFamily);
            }
        }

        // --- Notes Management (loadNotes, saveNotes, createNewNote, deleteNote remain the same) ---
        function loadNotes() {
            const savedNotes = localStorage.getItem('notesAppNotes');
            if (savedNotes) {
                notes = JSON.parse(savedNotes);
                notes.sort((a, b) => b.lastModified - a.lastModified);
            } else {
                notes = [ { id: Date.now() + 1, title: "Welcome Note", content: "<div>Start typing your notes here! Use the buttons for basic formatting. Drag notes in the sidebar to reorder. This app now works offline!</div>", tags: ["welcome", "getting started", "offline"], lastModified: Date.now() }, { id: Date.now() + 2, title: "Shopping List", content: '<ul class="checklist"><li><input type="checkbox"><span contenteditable="true"> Milk</span></li><li><input type="checkbox" checked><span contenteditable="true" style="text-decoration: line-through; opacity: 0.6;"> Bread (Bought)</span></li><li><input type="checkbox"><span contenteditable="true"> Eggs</span></li></ul><div><br></div><div>Remember reusable bags!</div>', tags: ["personal", "todo"], lastModified: Date.now() - 86400000 } ];
                saveNotes();
            }
        }
        function saveNotes() {
            notes.sort((a, b) => b.lastModified - a.lastModified);
            localStorage.setItem('notesAppNotes', JSON.stringify(notes));
        }
        function createNewNote() {
            saveCurrentNote();
            const newNote = { id: Date.now(), title: "Untitled Note", content: "<div></div>", tags: [], lastModified: Date.now() };
            notes.unshift(newNote);
            saveNotes(); renderNotesList(); displayNote(newNote.id);
            noteTitleInput.focus(); noteTitleInput.select(); enterFullscreen();
        }
        function deleteNote(id) {
            const deletedNoteIndex = notes.findIndex(note => note.id === id);
            if (deletedNoteIndex === -1) return;
            notes = notes.filter(note => note.id !== id);
            saveNotes(); renderNotesList();
            if (selectedNoteId === id) {
                let nextNoteToSelect = notes.length > 0 ? notes[Math.min(deletedNoteIndex, notes.length - 1)] : null;
                displayNote(nextNoteToSelect ? nextNoteToSelect.id : null);
            }
        }

        // --- Rendering (renderNotesList, displayNote, renderTagsPreview remain the same) ---
         function renderNotesList() {
            notesListEl.innerHTML = '';
            const searchTerm = searchInput.value.toLowerCase().trim();
            const filteredNotes = notes.filter(note => {
                const contentText = document.createElement('div'); contentText.innerHTML = note.content || '';
                return ( note.title.toLowerCase().includes(searchTerm) || contentText.textContent.toLowerCase().includes(searchTerm) || note.tags.some(tag => tag.toLowerCase().includes(searchTerm)) );
            });
             if (filteredNotes.length === 0 && searchTerm) { notesListEl.innerHTML = '<p class="text-center text-gray-500 dark:text-gray-400 p-4">No notes match search.</p>'; return; }
             else if (notes.length === 0) { notesListEl.innerHTML = '<p class="text-center text-gray-500 dark:text-gray-400 p-4">No notes yet.</p>'; return; }
            const notesToRender = searchTerm ? filteredNotes : notes;
            notesToRender.forEach(note => {
                const noteItem = document.createElement('div'); noteItem.classList.add('note-item', 'p-3', 'border-b', 'border-gray-200', 'dark:border-gray-700', 'hover:bg-gray-100', 'dark:hover:bg-gray-700', 'rounded-md', 'transition-all', 'duration-200', 'relative'); noteItem.dataset.id = note.id; noteItem.draggable = true; if (note.id === selectedNoteId) noteItem.classList.add('selected');
                const title = document.createElement('h3'); title.classList.add('font-semibold', 'text-gray-800', 'dark:text-gray-100', 'truncate', 'pointer-events-none', 'mb-1'); title.textContent = note.title || "Untitled";
                const preview = document.createElement('p'); preview.classList.add('text-sm', 'text-gray-600', 'dark:text-gray-300', 'truncate', 'pointer-events-none', 'mb-1'); const tempDiv = document.createElement('div'); tempDiv.innerHTML = note.content || ''; const previewText = tempDiv.textContent.trim(); preview.textContent = previewText.substring(0, 60) + (previewText.length > 60 ? '...' : '');
                const date = document.createElement('p'); date.classList.add('text-xs', 'text-gray-500', 'dark:text-gray-400', 'pointer-events-none'); date.textContent = `Modified: ${new Date(note.lastModified).toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' })}`;
                noteItem.append(title, preview, date);
                noteItem.addEventListener('click', () => { if (noteItem.classList.contains('dragging')) return; saveCurrentNote(); displayNote(note.id); enterFullscreen(); });
                notesListEl.appendChild(noteItem);
            });
        }
        function displayNote(id) {
            selectedNoteId = id; const note = notes.find(n => n.id === id);
            if (note) {
                noteEditorEl.classList.remove('hidden'); noNoteSelectedEl.classList.add('hidden');
                noteTitleInput.value = note.title; noteContentInput.innerHTML = note.content || ''; noteTagsInput.value = note.tags.join(', ');
                renderTagsPreview(note.tags); updateFormatButtonStates(); addChecklistEventListeners(noteContentInput);
            } else {
                selectedNoteId = null; noteEditorEl.classList.add('hidden');
                noNoteSelectedEl.classList.remove('hidden'); noNoteSelectedEl.classList.add('flex'); // Show placeholder
                noteTitleInput.value = ''; noteContentInput.innerHTML = ''; noteTagsInput.value = ''; renderTagsPreview([]);
                exitFullscreen();
            }
            renderNotesList();
        }
        function renderTagsPreview(tags) {
            tagsPreviewEl.innerHTML = '';
            tags.forEach(tag => { if (tag) { const tagEl = document.createElement('span'); tagEl.classList.add('tag'); tagEl.textContent = tag; tagsPreviewEl.appendChild(tagEl); } });
        }

        // --- Saving and Debouncing (handleNoteChange, saveCurrentNote remain the same) ---
        function handleNoteChange() {
            clearTimeout(debounceTimer);
            debounceTimer = setTimeout(() => {
                const changed = saveCurrentNote();
                if (changed) {
                     const note = notes.find(n => n.id === selectedNoteId);
                     if(note) { note.lastModified = Date.now(); saveNotes(); renderNotesList(); }
                }
            }, 500);
        }
        function saveCurrentNote() {
             if (!selectedNoteId) return false; const note = notes.find(n => n.id === selectedNoteId); let changed = false;
             if (note) {
                 const newTitle = noteTitleInput.value.trim(); const newContent = noteContentInput.innerHTML; const newTags = noteTagsInput.value.split(',').map(t => t.trim()).filter(t => t !== '');
                 if (note.title !== newTitle) { note.title = newTitle; changed = true; }
                 if (note.content !== newContent) { note.content = newContent; changed = true; }
                 if (JSON.stringify(note.tags) !== JSON.stringify(newTags)) { note.tags = newTags; changed = true; }
                 if(changed) console.log("Changes saved:", note.id);
             } return changed;
        }

        // --- Fullscreen Mode Logic (enterFullscreen, exitFullscreen remain the same) ---
        function enterFullscreen() {
            const isMobile = window.innerWidth < 768;
            if (isMobile && !bodyEl.classList.contains('editor-fullscreen')) { bodyEl.classList.add('editor-fullscreen'); isFullscreen = true; window.dispatchEvent(new Event('resize')); }
        }
        function exitFullscreen() {
            if (bodyEl.classList.contains('editor-fullscreen')) {
                 handleNoteChange(); setTimeout(() => { bodyEl.classList.remove('editor-fullscreen'); isFullscreen = false; window.dispatchEvent(new Event('resize')); }, 100);
            }
        }

        // --- Formatting & Checklist (applyFormat, insertChecklist, addChecklistEventListeners, handleChecklistClick, updateFormatButtonStates remain the same) ---
        function applyFormat(command) { document.execCommand(command, false, null); noteContentInput.focus(); updateFormatButtonStates(); handleNoteChange(); }
        function insertChecklist() {
            noteContentInput.focus(); const tempDiv = document.createElement('div'); const ul = document.createElement('ul'); ul.classList.add('checklist'); const li = document.createElement('li'); const checkbox = document.createElement('input'); checkbox.type = 'checkbox'; const span = document.createElement('span'); span.contentEditable = 'true'; span.textContent = ' List item'; li.append(checkbox, span); ul.appendChild(li); tempDiv.appendChild(ul); document.execCommand('insertHTML', false, tempDiv.innerHTML); addChecklistEventListeners(noteContentInput); handleNoteChange();
        }
        function addChecklistEventListeners(container) { container.removeEventListener('click', handleChecklistClick); container.addEventListener('click', handleChecklistClick); }
        function handleChecklistClick(event) {
            if (event.target.matches('#noteContent ul.checklist input[type="checkbox"]')) {
                const checkbox = event.target; const span = checkbox.nextElementSibling;
                if (span) { span.style.textDecoration = checkbox.checked ? 'line-through' : 'none'; span.style.opacity = checkbox.checked ? '0.6' : '1'; }
                handleNoteChange();
            }
        }
        function updateFormatButtonStates() {
             formatButtons.forEach(button => { const command = button.dataset.command; if (command && document.queryCommandSupported(command)) { try { button.classList.toggle('active', document.queryCommandState(command)); } catch (e) { console.error("Cmd state err:", command, e); button.classList.remove('active'); } } });
        }

        // --- Drag and Drop Handlers (handleDragStart, handleDragOver, handleDrop, handleDragEnd remain the same) ---
        function handleDragStart(e) { if (e.target.classList.contains('note-item')) { draggedItemId = e.target.dataset.id; e.dataTransfer.effectAllowed = 'move'; setTimeout(() => e.target.classList.add('dragging'), 0); } else { e.preventDefault(); } }
        function handleDragOver(e) { e.preventDefault(); e.dataTransfer.dropEffect = 'move'; const targetItem = e.target.closest('.note-item'); notesListEl.querySelectorAll('.drag-over').forEach(el => el.classList.remove('drag-over')); if (targetItem && targetItem.dataset.id !== draggedItemId) targetItem.classList.add('drag-over'); }
        function handleDrop(e) {
            e.preventDefault(); const targetItem = e.target.closest('.note-item'); const droppedOnId = targetItem ? targetItem.dataset.id : null; notesListEl.querySelectorAll('.drag-over').forEach(el => el.classList.remove('drag-over'));
            if (draggedItemId && droppedOnId && draggedItemId !== droppedOnId) {
                const draggedIndex = notes.findIndex(note => note.id == draggedItemId); let targetIndex = notes.findIndex(note => note.id == droppedOnId);
                if (draggedIndex !== -1 && targetIndex !== -1) { const [draggedNote] = notes.splice(draggedIndex, 1); targetIndex = notes.findIndex(note => note.id == droppedOnId); if (targetIndex === -1) notes.push(draggedNote); else notes.splice(targetIndex, 0, draggedNote); saveNotes(); renderNotesList(); }
            } handleDragEnd();
        }
        function handleDragEnd() { setTimeout(() => { notesListEl.querySelector('.dragging')?.classList.remove('dragging'); notesListEl.querySelectorAll('.drag-over').forEach(el => el.classList.remove('drag-over')); draggedItemId = null; }, 0); }

        // --- Event Listeners Setup ---
        function setupEventListeners() {
            newNoteBtn.addEventListener('click', createNewNote);

            searchInput.addEventListener('input', () => { renderNotesList(); clearSearchBtn.style.display = searchInput.value ? 'inline-block' : 'none'; });
            clearSearchBtn.addEventListener('click', () => { searchInput.value = ''; clearSearchBtn.style.display = 'none'; renderNotesList(); searchInput.focus(); });

            noteTitleInput.addEventListener('input', handleNoteChange);
            noteContentInput.addEventListener('input', handleNoteChange);
            noteTagsInput.addEventListener('input', () => { const tags = noteTagsInput.value.split(',').map(t => t.trim()).filter(t => t !== ''); renderTagsPreview(tags); handleNoteChange(); });

            noteContentInput.addEventListener('keyup', updateFormatButtonStates);
            noteContentInput.addEventListener('mouseup', updateFormatButtonStates);
            noteContentInput.addEventListener('focus', () => { updateFormatButtonStates(); addChecklistEventListeners(noteContentInput); });
            noteContentInput.addEventListener('blur', () => { handleNoteChange(); setTimeout(updateFormatButtonStates, 100); });

            deleteNoteBtn.addEventListener('click', () => { if (selectedNoteId && confirm(`Delete "${notes.find(n=>n.id===selectedNoteId)?.title || 'this note'}"?`)) deleteNote(selectedNoteId); });

            formatButtons.forEach(button => { const command = button.dataset.command; if (command) button.addEventListener('click', (e) => { e.preventDefault(); applyFormat(command); }); });
            checklistBtn.addEventListener('click', (e) => { e.preventDefault(); insertChecklist(); });

            settingsBtn.addEventListener('click', () => settingsModal.classList.add('flex'));
            closeSettingsBtn.addEventListener('click', () => settingsModal.classList.remove('flex'));
            settingsModal.addEventListener('click', (e) => { if (e.target === settingsModal) settingsModal.classList.remove('flex'); });

            // Settings Change Listeners
            darkModeToggle.addEventListener('change', () => { settings.darkMode = darkModeToggle.checked; applySettings(); saveSettings(); });
            fontSizeSelect.addEventListener('change', (e) => { settings.fontSize = e.target.value; applySettings(); saveSettings(); });
            fontFamilySelect.addEventListener('change', (e) => { settings.fontFamily = e.target.value; applySettings(); saveSettings(); });

            backBtn.addEventListener('click', exitFullscreen);
            document.addEventListener('keydown', (e) => { if (e.key === 'Escape' && bodyEl.classList.contains('editor-fullscreen')) exitFullscreen(); });

            window.addEventListener('beforeunload', () => { clearTimeout(debounceTimer); const changed = saveCurrentNote(); if (changed) { const note = notes.find(n => n.id === selectedNoteId); if(note) note.lastModified = Date.now(); saveNotes(); } });

            noteTitleInput.addEventListener('blur', handleNoteChange);
            noteTagsInput.addEventListener('blur', handleNoteChange);

            notesListEl.addEventListener('dragstart', handleDragStart);
            notesListEl.addEventListener('dragover', handleDragOver);
            notesListEl.addEventListener('drop', handleDrop);
            notesListEl.addEventListener('dragend', handleDragEnd);
            document.body.addEventListener('dragover', e => e.preventDefault());
            document.body.addEventListener('drop', e => e.preventDefault());
        }

        // --- Utility Functions ---
        function checkInitialState() {
            if (notes.length > 0) displayNote(notes[0].id); else displayNote(null);
            const isMobile = window.innerWidth < 768;
            if (!isMobile && bodyEl.classList.contains('editor-fullscreen')) exitFullscreen();
        }

    </script>
</body>
</html>
